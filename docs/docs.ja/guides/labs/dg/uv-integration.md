---
title: 'UV統合'
sidebar_position: 500
---

import Preview from '@site/docs.ja/partials/\_Preview.md';

<Preview />

特に複数のプロジェクトでの開発を容易にするために、`dg` は [`uv` パッケージ マネージャー](https://docs.astral.sh/uv/) と統合されます。

:::note

私たちは `uv` 統合の構成を合理化する作業を進めており、今後数回のリリースで変更される可能性があります。

:::

## デフォルトの `dg` 動作 (`uv run`)

`dg` 自体はグローバルにインストールされ、常に分離された環境で実行されます。ただし、多くの `dg` コマンドは、特定のプロジェクトにスコープされた環境でサブプロセスを生成する必要があります。たとえば、プロジェクト ディレクトリで `dg list component-type` を実行すると、`dg` はそのプロジェクトで使用可能なコンポーネント タイプのみを一覧表示します。

`dg` をデフォルト設定で使用する場合、Python サブプロセスは、プロジェクト ディレクトリで仮想環境を検出した後に生成されます。つまり、シェル `PATH` で最初の `python` 実行可能ファイルを見つけるのではなく、その仮想環境が現在アクティブ化されていない場合でも、ローカルで検出された仮想環境の Python 実行可能ファイルを使用します。

デフォルトでは、`dg` は環境の検出とコマンドの実行に `uv run` という特別な `uv` コマンドを使用します。`uv run` は、コマンドを実行する前にローカル仮想環境 (祖先ディレクトリの `.venv`) を解決し、さらにコマンドを実行する前に、環境がプロジェクトの指定された依存関係で最新であることを確認します。

`dg` が `uv run` を使用するということは、開発中に仮想環境をアクティブ化および非アクティブ化してグローバル シェルの状態を管理する必要がないことを意味します。代わりに、`dg` は各プロジェクトのルートに `.venv` ディレクトリがあることを想定し (スキャフォールディングも行います)、そのプロジェクトに対してコマンド (`dg scaffold defs` や `dg list component-type` など) を実行するときにその仮想環境を使用します。

## `uv run` の使用を無効にする

`--no-use-dg-managed-environment` フラグを `dg` コマンドに渡すことで、`dg` による `uv run` の使用を無効にすることができます。これにより、`dg` は引き続き `.venv` の祖先ツリーを検索してローカル仮想環境を解決しようとしますが、`uv run` を経由せずに Python プロセスを直接起動します。

仮想環境の検出を完全にオプトアウトし、アンビエント Python 環境 (システム Python またはアクティブ化された仮想環境) のみを使用する場合は、(a) `--no-require-local-venv` を設定し、(b) プロジェクトの祖先ツリーに `.venv` ディレクトリがないことを確認する必要があります。

:::info

`--no-use-dg-managed-environment` を使用して `uv` 統合を無効にすると、現在 `dg cache` が無効になります。これにより、一部の操作が著しく遅くなります。

:::
