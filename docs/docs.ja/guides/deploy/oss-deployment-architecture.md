---
title: 'オープンソースの展開アーキテクチャの概要'
sidebar_position: 100
---

:::note

このガイドは、Dagsterオープンソース（OSS）のデプロイメントに適用されます。
Dagster+のデプロイメントについては、[Dagster+](/dagster-plus/)のドキュメントを参照してください。

:::

このページでは、Dagster を独自のインフラストラクチャにデプロイするための一般的な情報について説明します。
特定のプラットフォームに関するガイドについては、[デプロイオプションのドキュメント](/guides/deploy/deployment-options/) をご覧ください。

まず、一般的な Dagster のデプロイ例を見てみましょう。その後、各コンポーネントについて順に説明します:

{/* https://excalidraw.com/#json=4771198026121216,nmLfShZ_frrUPJTUxaeI5g */}

![Dagster deployment](/images/guides/deploy/dagster-deployment.png)

## 長期実行サービス

Dagster には、以下の表に示す 3 つの長期実行サービスが必要です:

| Service                                                   | Description                                                                           | Replicas                                                                                                  |
| --------------------------------------------------------- | ------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------- |
| [Dagster webserver](/guides/operate/webserver)            | `dagster-webserver` はユーザー インターフェイスを提供し、GraphQL クエリに応答します。   | Dagster Web サーバーは 1 つ以上のレプリカを持つことができます。|
| [Dagster daemon](/guides/deploy/execution/dagster-daemon) | Dagster デーモンは、スケジュール、センサー、実行キューを操作します。    | サポートされていません。     |
| [Code location](/guides/deploy/code-locations/) server    | コード ロケーション サーバーは、Dagster 定義のコレクションに関するメタデータを提供します。 | コード ロケーション サーバーは複数存在できますが、各コード ロケーションにはそのサーバーのレプリカを 1 つだけ存在させることができます。 |

## デプロイ構成

Dagster OSS デプロイメントは、ストレージ、エグゼキュータ、実行ランチャーなどの複数のコンポーネントで構成されています。
Dagster のコア機能の 1 つは、これらの各コンポーネントが交換可能かつ構成可能であることです。
カスタム構成が指定されていない場合、Dagster は各コンポーネントのデフォルト実装を自動的に使用します。
たとえば、デフォルトでは、Dagster はパイプライン実行に関する情報を保存するために <PyObject section="internals" module="dagster._core.storage.runs" object="SqliteRunStorage" /> を使用します。
これは、Dagster が提供する <PyObject section="libraries" module="dagster_postgres" object="PostgresRunStorage"/> またはカスタムストレージクラスと交換できます。

コンポーネントのスコープに基づいて、**Dagster インスタンス** レベルまたは **ジョブ実行** レベルで構成が行われます。
ユーザーコードへのアクセスは、**ワークスペース** レベルで構成されます。
各レベルでコンポーネントがどのように構成されるかについては、次の表を参照してください。

| Level                                                             | Configuration    | Description                                                                                                                                                                                                                                                                                                                                                 |
| ----------------------------------------------------------------- | ---------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [Dagster instance](/guides/deploy/dagster-instance-configuration) | `dagster.yaml`   | Dagsterインスタンスは、データベースなど、デプロイメント全体のすべてのコンポーネントの管理を担います。インスタンスレベルのコンポーネントの設定は、`dagster.yaml`で指定できます。|
| [Workspace](/guides/deploy/code-locations/workspace-yaml)         | `workspace.yaml` | ワークスペースファイルは、コードへのアクセス方法と読み込み方法を定義します。ワークスペースの設定は `workspace.yaml` を使って定義できます。 |
| Job run                                                           | Run config       | ジョブ実行は、エグゼキュータ、オペレーション、リソースなど、ジョブスコープ内のすべてのコンポーネントの管理を担当します。これらのコンポーネントは、オペレーションの実行方法や出力の保存場所など、ジョブの動作を指示します。<br/> 実行レベルコンポーネントの設定は、ジョブ実行の実行構成を使用して指定され、PythonコードまたはUIランチパッドで定義されます。 |

:::note

Dagster は、上記の構成オプションの一部を抽象化する、垂直統合型のデプロイメント オプションをいくつか提供しています。
例えば、Dagster が提供する [Kubernetes Helm チャート デプロイメント](/guides/deploy/deployment-options/kubernetes/deploying-to-kubernetes) では、構成は Helm 値によって定義され、Kubernetes デプロイメントによって Dagster インスタンスとワークスペースの構成が自動的に生成されます。

:::

## ジョブ実行フロー

ジョブの実行は、Dagster システムの複数の部分を通過します。
次の表は、UI によって開始される実行、特に実行を処理するコンポーネントとそれらの実行順序について説明しています。

| Order                                                        | Component                                                                                                                                                                                                                                                   | Description | Configured by |
| ------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- | ------------- |
| [Run coordinator](/guides/deploy/execution/run-coordinators) | 実行コーディネーターは、Dagster UIから実行が開始されたときにウェブサーバープロセスによって呼び出されるクラスです。このクラスは、キューを介してデーモンに実行を渡すように設定できます。                  | Instance    |
| [Run launcher](/guides/deploy/execution/run-launchers)       | 実行ランチャーは、デーモンがキューから実行を受け取った際に呼び出されるクラスです。このクラスは、実行を処理するための新しい実行ワーカーを初期化します。ランチャーによっては、新しいプロセス、コンテナ、Kubernetesポッドなどを起動することもあります。 | Instance    |
| Run worker                                                   | 実行ワーカーは、グラフを走査し、エグゼキュータを使用して各オペレーションを実行するプロセスです。           | n/a         |
| [Executor](/guides/operate/run-executors)                    | Executorは、ユーザーオペレーションを実行するために実行ワーカーによって呼び出されるクラスです。Executorに応じて、オペレーションはローカルプロセス、新しいコンテナ、Kubernetesポッドなどで実行されます。| Run config  |

さらに、スケジュールとセンサーによって開始される実行は同じフローを辿りますが、最初のステップはウェブサーバーではなく[Dagsterデーモン](/guides/deploy/execution/dagster-daemon)によって呼び出されることに注意してください。

[Dagsterデーモン](/guides/deploy/execution/dagster-daemon)を使用しないデプロイメントでは、ウェブサーバーは**run launcher**を直接呼び出し、**run coordinator**をスキップします。
